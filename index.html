<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ALZA STORE</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-900">
  <div class="max-w-6xl mx-auto p-4">
    <h1 class="text-3xl font-bold mb-4">ALZA STORE</h1>
    <div id="loading" class="fixed inset-0 flex items-center justify-center bg-white bg-opacity-90 text-lg hidden">Menghubungkan ke Database...</div>

    <section id="dashboard" class="hidden">
      <h2 class="text-xl font-semibold mb-2">Dashboard Penjualan</h2>
      <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
        <div class="p-4 bg-white shadow rounded">
          <p class="font-medium">Total Penjualan:</p>
          <p id="totalPenjualan" class="text-xl font-bold">Rp 0</p>
        </div>
        <div class="p-4 bg-white shadow rounded">
          <p class="font-medium">Total Keuntungan:</p>
          <p id="totalKeuntungan" class="text-xl font-bold">Rp 0</p>
        </div>
        <div class="p-4 bg-white shadow rounded">
          <p class="font-medium">Total Produk:</p>
          <p id="totalProduk" class="text-xl font-bold">0</p>
        </div>
      </div>
    </section>

    <section id="inventory" class="mt-6">
      <h2 class="text-xl font-semibold mb-2">Data Stok Barang</h2>
      <form id="productForm" class="grid grid-cols-1 md:grid-cols-5 gap-2 mb-4">
        <input type="text" id="sku" placeholder="SKU" class="border p-2 rounded" required>
        <input type="text" id="name" placeholder="Nama Produk" class="border p-2 rounded" required>
        <input type="number" id="cost" placeholder="Modal" class="border p-2 rounded" required>
        <input type="number" id="price" placeholder="Harga Jual" class="border p-2 rounded" required>
        <input type="number" id="stock" placeholder="Stok" class="border p-2 rounded" required>
        <button type="submit" class="col-span-1 md:col-span-5 bg-blue-600 text-white py-2 rounded">Tambah Produk</button>
      </form>

      <table class="min-w-full bg-white border rounded shadow">
        <thead>
          <tr class="bg-gray-200 text-left">
            <th class="p-2">SKU</th>
            <th class="p-2">Nama</th>
            <th class="p-2">Modal</th>
            <th class="p-2">Harga</th>
            <th class="p-2">Stok</th>
            <th class="p-2">Aksi</th>
          </tr>
        </thead>
        <tbody id="productTable"></tbody>
      </table>
    </section>
  </div>

  <script>
    const supabaseUrl = 'https://pmxkyzgsauzxeidbjuhd.supabase.co'; // ganti
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBteGt5emdzYXV6eGVpZGJqdWhkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjExMjMwNDAsImV4cCI6MjA3NjY5OTA0MH0.oXlVN7F-CXN6zDCuOOr8u2N6efIo9GWd9JyJ5O0_fyA'; // ganti
    const supabase = supabase.createClient(supabaseUrl, supabaseKey);

    const loading = document.getElementById('loading');
    const dashboard = document.getElementById('dashboard');
    const tableBody = document.getElementById('productTable');

    document.addEventListener('DOMContentLoaded', async () => {
      loading.classList.remove('hidden');
      try {
        await loadProducts();
        await updateDashboard();
        loading.classList.add('hidden');
        dashboard.classList.remove('hidden');
      } catch (err) {
        loading.textContent = 'Gagal terhubung ke database: ' + err.message;
      }
    });

    async function loadProducts() {
      const { data, error } = await supabase.from('products').select('*');
      if (error) throw error;
      tableBody.innerHTML = '';
      data.forEach(p => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td class='p-2'>${p.sku}</td>
          <td class='p-2'>${p.name}</td>
          <td class='p-2'>Rp ${p.cost.toLocaleString('id-ID')}</td>
          <td class='p-2'>Rp ${p.price.toLocaleString('id-ID')}</td>
          <td class='p-2'>${p.stock}</td>
          <td class='p-2'>
            <button class='bg-yellow-500 text-white px-2 py-1 rounded' onclick='editProduct(${p.id})'>Edit</button>
            <button class='bg-red-600 text-white px-2 py-1 rounded' onclick='deleteProduct(${p.id})'>Hapus</button>
          </td>`;
        tableBody.appendChild(row);
      });
    }

    document.getElementById('productForm').addEventListener('submit', async e => {
      e.preventDefault();
      const sku = document.getElementById('sku').value;
      const name = document.getElementById('name').value;
      const cost = parseFloat(document.getElementById('cost').value);
      const price = parseFloat(document.getElementById('price').value);
      const stock = parseInt(document.getElementById('stock').value);

      const { error } = await supabase.from('products').insert([{ sku, name, cost, price, stock }]);
      if (error) return alert('Gagal menambah produk: ' + error.message);
      e.target.reset();
      loadProducts();
      updateDashboard();
    });

    async function deleteProduct(id) {
      if (!confirm('Yakin hapus produk ini?')) return;
      const { error } = await supabase.from('products').delete().eq('id', id);
      if (error) alert('Gagal hapus: ' + error.message);
      else loadProducts();
    }

    async function updateDashboard() {
      const { data: products } = await supabase.from('products').select('*');
      const { data: sales } = await supabase.from('sales').select('*');
      const totalProduk = products ? products.length : 0;
      const totalPenjualan = sales ? sales.reduce((s, x) => s + x.total, 0) : 0;
      const totalKeuntungan = sales ? sales.reduce((s, x) => s + x.profit, 0) : 0;
      document.getElementById('totalProduk').textContent = totalProduk;
      document.getElementById('totalPenjualan').textContent = 'Rp ' + totalPenjualan.toLocaleString('id-ID');
      document.getElementById('totalKeuntungan').textContent = 'Rp ' + totalKeuntungan.toLocaleString('id-ID');
    }
  </script>
</body>
</html>

